<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¸æˆåŠ è½½è°ƒè¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #2c3e50;
            color: white;
        }
        .debug-section {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
        }
        .log {
            background: black;
            color: lime;
            font-family: monospace;
            padding: 15px;
            border-radius: 5px;
            height: 300px;
            overflow-y: auto;
        }
        .btn {
            padding: 10px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ æ¸¸æˆåŠ è½½é—®é¢˜è°ƒè¯•</h1>
    
    <div class="debug-section">
        <h2>1. æ•°æ®åŠ è½½æµ‹è¯•</h2>
        <button class="btn" onclick="testDataLoading()">æµ‹è¯•games.jsonåŠ è½½</button>
        <button class="btn" onclick="testGameById('body-drop-3d-gamepix')">æŸ¥æ‰¾æŒ‡å®šæ¸¸æˆ</button>
        <div id="dataResult" style="margin-top: 10px;"></div>
    </div>
    
    <div class="debug-section">
        <h2>2. JavaScriptå‡½æ•°æµ‹è¯•</h2>
        <button class="btn" onclick="testFunctions()">æµ‹è¯•å…³é”®å‡½æ•°</button>
        <div id="funcResult" style="margin-top: 10px;"></div>
    </div>
    
    <div class="debug-section">
        <h2>3. å®æ—¶è°ƒè¯•æ—¥å¿—</h2>
        <div class="log" id="debugLog">ç­‰å¾…è°ƒè¯•å¼€å§‹...<br></div>
    </div>

    <!-- åŠ è½½å®é™…çš„æ¸¸æˆè„šæœ¬ -->
    <script src="/js/utils.js?v=20250908"></script>
    <script src="/js/analytics.js?v=20250908"></script>
    <script src="/js/games.js?v=20250908"></script>

    <script>
        function log(message) {
            const debugLog = document.getElementById('debugLog');
            const timestamp = new Date().toLocaleTimeString();
            debugLog.innerHTML += `[${timestamp}] ${message}<br>`;
            debugLog.scrollTop = debugLog.scrollHeight;
            console.log(`[Debug] ${message}`);
        }

        async function testDataLoading() {
            log('å¼€å§‹æµ‹è¯•æ•°æ®åŠ è½½...');
            
            try {
                // æµ‹è¯•ç›´æ¥fetch
                const response = await fetch('/data/games.json');
                log(`Fetchå“åº”çŠ¶æ€: ${response.status}`);
                
                const data = await response.json();
                log(`JSONè§£ææˆåŠŸï¼Œæ¸¸æˆæ•°é‡: ${data.games ? data.games.length : 'æœªæ‰¾åˆ°gamesæ•°ç»„'}`);
                
                document.getElementById('dataResult').innerHTML = `
                    <div style="color: green;">âœ… æ•°æ®åŠ è½½æˆåŠŸ</div>
                    <div>æ¸¸æˆæ€»æ•°: ${data.games?.length || 0}</div>
                    <div>ç¬¬ä¸€ä¸ªæ¸¸æˆID: ${data.games?.[0]?.id || 'æ— '}</div>
                `;
                
                // æµ‹è¯•loadGameDataå‡½æ•°
                if (typeof loadGameData === 'function') {
                    log('æµ‹è¯•loadGameDataå‡½æ•°...');
                    await loadGameData();
                    log(`loadGameDataå®Œæˆï¼Œwindow.gamesData: ${window.gamesData ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®'}`);
                } else {
                    log('âŒ loadGameDataå‡½æ•°ä¸å­˜åœ¨');
                }
                
            } catch (error) {
                log(`âŒ æ•°æ®åŠ è½½å¤±è´¥: ${error.message}`);
                document.getElementById('dataResult').innerHTML = `
                    <div style="color: red;">âŒ æ•°æ®åŠ è½½å¤±è´¥</div>
                    <div>${error.message}</div>
                `;
            }
        }

        async function testGameById(gameId) {
            log(`æŸ¥æ‰¾æ¸¸æˆ: ${gameId}`);
            
            try {
                // å…ˆç¡®ä¿æ•°æ®åŠ è½½äº†
                if (!window.gamesData) {
                    log('æ•°æ®æœªåŠ è½½ï¼Œå…ˆåŠ è½½æ•°æ®...');
                    await loadGameData();
                }
                
                // æµ‹è¯•getGameByIdå‡½æ•°
                if (typeof getGameById === 'function') {
                    const game = getGameById(gameId);
                    log(`getGameByIdç»“æœ: ${game ? `æ‰¾åˆ°æ¸¸æˆ ${game.title}` : 'æœªæ‰¾åˆ°æ¸¸æˆ'}`);
                    
                    if (game) {
                        log(`æ¸¸æˆè¯¦æƒ…: æ ‡é¢˜=${game.title}, URL=${game.iframeUrl}`);
                        document.getElementById('dataResult').innerHTML += `
                            <div style="color: green; margin-top: 10px;">âœ… æ‰¾åˆ°æ¸¸æˆ</div>
                            <div>ID: ${game.id}</div>
                            <div>æ ‡é¢˜: ${game.title}</div>
                            <div>iframe URL: ${game.iframeUrl}</div>
                            <div>æ¥æº: ${game.source}</div>
                        `;
                    }
                } else {
                    log('âŒ getGameByIdå‡½æ•°ä¸å­˜åœ¨');
                }
                
            } catch (error) {
                log(`âŒ æŸ¥æ‰¾æ¸¸æˆå¤±è´¥: ${error.message}`);
            }
        }

        function testFunctions() {
            log('æµ‹è¯•JavaScriptå‡½æ•°å¯ç”¨æ€§...');
            
            const functions = [
                'loadGameData',
                'getGameById', 
                'loadGamePage',
                'updateGamePageContent',
                'loadGameIframe'
            ];
            
            let result = '';
            functions.forEach(funcName => {
                const exists = typeof window[funcName] === 'function';
                log(`${funcName}: ${exists ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}`);
                result += `<div>${funcName}: ${exists ? 'âœ…' : 'âŒ'}</div>`;
            });
            
            document.getElementById('funcResult').innerHTML = result;
        }

        // æ¨¡æ‹Ÿæ¸¸æˆé¡µé¢çš„åˆå§‹åŒ–è¿‡ç¨‹
        function simulateGamePageInit() {
            log('=== æ¨¡æ‹Ÿæ¸¸æˆé¡µé¢åˆå§‹åŒ–è¿‡ç¨‹ ===');
            
            const gameId = 'body-drop-3d-gamepix';
            log(`æ¨¡æ‹ŸURLå‚æ•°: ?id=${gameId}`);
            
            // æ¨¡æ‹Ÿgame.htmlçš„åˆå§‹åŒ–é€»è¾‘
            if (gameId) {
                log('å¼€å§‹è°ƒç”¨loadGamePage...');
                if (typeof loadGamePage === 'function') {
                    loadGamePage(gameId).then(() => {
                        log('loadGamePageå®Œæˆ');
                    }).catch(error => {
                        log(`loadGamePageå¤±è´¥: ${error.message}`);
                    });
                } else {
                    log('âŒ loadGamePageå‡½æ•°ä¸å­˜åœ¨');
                }
            } else {
                log('âŒ æœªæ‰¾åˆ°æ¸¸æˆID');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåå¼€å§‹è°ƒè¯•
        window.addEventListener('load', function() {
            log('è°ƒè¯•é¡µé¢å·²åŠ è½½');
            log('JavaScriptæ–‡ä»¶åŠ è½½çŠ¶æ€æ£€æŸ¥...');
            
            // æ£€æŸ¥å…³é”®å˜é‡å’Œå‡½æ•°
            log(`window.gamesData: ${window.gamesData ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®'}`);
            
            // è‡ªåŠ¨å¼€å§‹ä¸€äº›åŸºç¡€æµ‹è¯•
            setTimeout(() => {
                testFunctions();
                testDataLoading();
            }, 1000);
        });
    </script>
</body>
</html>